#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ‰ Post-merge tasks starting..."

# í˜„ì¬ ë¸Œëœì¹˜ í™•ì¸
current_branch=$(git rev-parse --abbrev-ref HEAD)

# main/master ë¸Œëœì¹˜ë¼ë©´ ì¶”ê°€ ì‘ì—… ìˆ˜í–‰
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
  echo "ğŸŒŸ Merged to main branch! Running additional checks..."
  
  # ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ í™•ì¸
  if git diff --name-only HEAD@{1} HEAD | grep -E "(package\.json|pnpm-lock\.yaml)" > /dev/null; then
    echo "ğŸ“¦ Dependencies updated, installing..."
    pnpm install
  fi
  
  # ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰
  echo "ğŸ”¨ Running final build check..."
  pnpm build
  
  echo "ğŸ§ª Running final test suite..."
  pnpm test
  
  echo "âœ… Main branch is ready for deployment!"
else
  echo "ğŸ“ Merged to feature branch: $current_branch"
fi

echo "âœ… Post-merge tasks completed!" 